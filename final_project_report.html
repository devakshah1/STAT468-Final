<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Devak Shah">

<title>STAT468 Final Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-123bf1f8be61e52d793a06c138bba625.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">STAT468 Final Project</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Devak Shah </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>The objective of this project is to investigate the relationship between OHL performance / player build and NHL career longevity. We will analyze how various factors such as goals per game, assists per game, height, and weight influence the probability of a player playing more than 200 games in the NHL.</p>
<p><strong>CHAPTER 1: IMPORT</strong></p>
<p>The first step in our project is to import the necessary libraries and data:</p>
<div id="d21528c2" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> TopDownHockey_Scraper.TopDownHockey_NHL_Scraper <span class="im">as</span> tdhnhlscrape</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> TopDownHockey_Scraper.TopDownHockey_EliteProspects_Scraper <span class="im">as</span> tdhepscrape</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nhlpy <span class="im">import</span> NHLClient</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="9a81a013" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lets_plot <span class="im">import</span> <span class="op">*</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>LetsPlot.setup_html()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <div id="JXj6Yj"></div>
            <script type="text/javascript" data-lets-plot-script="library">
                if(!window.letsPlotCallQueue) {
                    window.letsPlotCallQueue = [];
                }; 
                window.letsPlotCall = function(f) {
                    window.letsPlotCallQueue.push(f);
                };
                (function() {
                    var script = document.createElement("script");
                    script.type = "text/javascript";
                    script.src = "https://cdn.jsdelivr.net/gh/JetBrains/lets-plot@v4.7.0/js-package/distr/lets-plot.min.js";
                    script.onload = function() {
                        window.letsPlotCall = function(f) {f();};
                        window.letsPlotCallQueue.forEach(function(f) {f();});
                        window.letsPlotCallQueue = [];
                        
                    };
                    script.onerror = function(event) {
                        window.letsPlotCall = function(f) {};    // noop
                        window.letsPlotCallQueue = [];
                        var div = document.createElement("div");
                        div.style.color = 'darkred';
                        div.textContent = 'Error loading Lets-Plot JS';
                        document.getElementById("JXj6Yj").appendChild(div);
                    };
                    var e = document.getElementById("JXj6Yj");
                    e.appendChild(script);
                })()
            </script>
            
</div>
</div>
<p>We will create a toggle to see if we want to rescrape the data or just import the prior scrape from an existing file. If <code>scrape</code> is set to <code>True</code>, we will scrape the data; otherwise, we will read from the existing file.</p>
<div id="94aa8e8f" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>scrape <span class="op">=</span> <span class="va">False</span> <span class="co"># Set to True to scrape data, False to use existing data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#This will be the file name where data is stored in our git repo</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">"regression_input.xlsx"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First, we loop through a bunch of seasons and scrape player OHL stats and builds. Not that we get rid of player positions so that we can join with player builds using names as index. While this is mixing some of steps 2&amp;3 (Tidy&amp;Transform), it’s easier to do it here since we want to get the player builds at the time of the draft, and it would be confusing to do the join later on, when we’re outside the loop and the stats&amp;builds may not correspond to one another since they could be from seperate years.</p>
<div id="4b0a2b85" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get OHL Player Data (stats, build, etc)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> scrape <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Can't include all years because of backend data issues in some years</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#years = ["2004-2005", "2006-2007", "2007-2008", "2008-2009", "2009-2010", "2010-2011", "2011-2012", "2012-2013", "2013-2014", </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#         "2014-2015", "2015-2016", "2016-2017", "2017-2018", "2018-2019"]</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> [<span class="st">"2016-2017"</span>, <span class="st">"2013-2014"</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    aggregated_output <span class="op">=</span> pd.DataFrame()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> tdhepscrape.get_skaters((<span class="st">"ohl"</span>), (year))[<span class="dv">0</span>:<span class="dv">50</span>]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">#GET PLAYER INFO</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        info <span class="op">=</span> tdhepscrape.get_player_information(df)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">#GET RID OF PLAYER POSITIONS FROM NAMES</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">'player'</span>] <span class="op">=</span> df[<span class="st">'player'</span>].<span class="bu">str</span>.replace(<span class="vs">r'</span><span class="dv">\s</span><span class="op">*</span><span class="ch">\(</span><span class="pp">[^)]</span><span class="op">*</span><span class="ch">\)</span><span class="vs">'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ADD YEAR TO DF</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        df.insert(<span class="dv">0</span>, <span class="st">"year"</span>, year)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">#JOIN PLAYER BIO WITH STATS</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        year_output <span class="op">=</span> pd.merge(df[[<span class="st">"year"</span>, <span class="st">"player"</span>, <span class="st">"gp"</span>, <span class="st">"g"</span>, <span class="st">"a"</span>, <span class="st">"tp"</span>]], info[[<span class="st">"player"</span>, <span class="st">"dob"</span>, <span class="st">"height"</span>, <span class="st">"weight"</span>, <span class="st">"shoots"</span>]], on<span class="op">=</span><span class="st">'player'</span>, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ADD CURRENT YEAR PROSPECTS TO AGGREGATED DF</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        aggregated_output <span class="op">=</span> pd.concat([aggregated_output, year_output])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we print the draftyears of all NHL players drafted between 2005 and 2020</p>
<div id="eadd1a6c" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> scrape <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    years <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">2005</span>, <span class="dv">2021</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    draftyears <span class="op">=</span> pd.DataFrame()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        df_list <span class="op">=</span> pd.read_html(<span class="ss">f"https://www.hockey-reference.com/draft/NHL_</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">_entry.html"</span>, match<span class="op">=</span><span class="st">"Round"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        players_drafted <span class="op">=</span> df_list[<span class="dv">0</span>]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        players_drafted</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Let's get rid of the top header that isnt really used</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        players_drafted.columns <span class="op">=</span> players_drafted.columns.get_level_values(<span class="dv">1</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        players_drafted[<span class="st">"draft_year"</span>] <span class="op">=</span> year</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        players_drafted <span class="op">=</span> players_drafted[[<span class="st">"draft_year"</span>, <span class="st">"Player"</span>]]</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        players_drafted <span class="op">=</span>players_drafted.rename(columns<span class="op">=</span>{<span class="st">"draft_year"</span>: <span class="st">"player_draft_year"</span>, <span class="st">"Player"</span>: <span class="st">"player"</span>})</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        draftyears <span class="op">=</span> pd.concat([draftyears, players_drafted])</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(draftyears)        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we get the games played for all NHL players to have played at least 1 game in the NHL. We will use this to calculate the probability of a player playing more than 200 games in the NHL.</p>
<div id="d9e64ab9" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Getting games played for all NHL players</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> scrape <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    nhl_gp <span class="op">=</span> pd.DataFrame()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    pages <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">80</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> page <span class="kw">in</span> pages:</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        df_list <span class="op">=</span> pd.read_html(<span class="ss">f"https://www.eliteprospects.com/league/nhl/stats/all-time?page=</span><span class="sc">{</span>page<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        page_stats <span class="op">=</span> df_list[<span class="dv">2</span>]</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        page_stats <span class="op">=</span> page_stats[[<span class="st">"Player"</span>, <span class="st">"GP"</span>]]</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        nhl_gp <span class="op">=</span> pd.concat([nhl_gp, page_stats])</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    nhl_gp <span class="op">=</span> nhl_gp.rename(columns<span class="op">=</span>{<span class="st">"Player"</span>: <span class="st">"player"</span>, <span class="st">"GP"</span>: <span class="st">"nhl_gp"</span>})</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#GET RID OF PLAYER POSITIONS FROM NAMES</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    nhl_gp[<span class="st">'player'</span>] <span class="op">=</span> nhl_gp[<span class="st">'player'</span>].<span class="bu">str</span>.replace(<span class="vs">r'</span><span class="dv">\s</span><span class="op">*</span><span class="ch">\(</span><span class="pp">[^)]</span><span class="op">*</span><span class="ch">\)</span><span class="vs">'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replacing NA and "-" values with 0</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    nhl_gp[<span class="st">"nhl_gp"</span>] <span class="op">=</span> nhl_gp[<span class="st">"nhl_gp"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    nhl_gp[<span class="st">"nhl_gp"</span>] <span class="op">=</span> nhl_gp[<span class="st">"nhl_gp"</span>].replace(<span class="st">"-"</span>, <span class="dv">0</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    nhl_gp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>CHAPTER 2: TIDY</strong></p>
<p>We first get rid of defencemen from our dataset, since we are only concerned with forwards.</p>
<div id="42b1f53c" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> scrape <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    aggregated_output <span class="op">=</span> aggregated_output[<span class="op">~</span>aggregated_output[<span class="st">'player'</span>].<span class="bu">str</span>.contains(<span class="vs">r'</span><span class="ch">\(</span><span class="kw">(</span><span class="pp">[^)]</span><span class="op">*</span><span class="vs">D</span><span class="pp">[^)]</span><span class="op">*</span><span class="kw">)</span><span class="ch">\)</span><span class="vs">'</span>, regex<span class="op">=</span><span class="va">True</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we change the type of some columns - they are objects by default, we need them to be integeres to regress on them later on. We also replace “-” values with 0 for regression purposes, since “-” means that the player did not play in that season, and we want to treat that as 0 games played.</p>
<div id="7c666eca" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> scrape <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    aggregated_output[<span class="st">"gp"</span>] <span class="op">=</span> aggregated_output[<span class="st">"gp"</span>].replace(<span class="st">"-"</span>, <span class="dv">0</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    aggregated_output[<span class="st">"gp"</span>] <span class="op">=</span> aggregated_output[<span class="st">"gp"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    aggregated_output[<span class="st">"g"</span>] <span class="op">=</span> aggregated_output[<span class="st">"g"</span>].replace(<span class="st">"-"</span>, <span class="dv">0</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    aggregated_output[<span class="st">"g"</span>] <span class="op">=</span> aggregated_output[<span class="st">"g"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    aggregated_output[<span class="st">"a"</span>] <span class="op">=</span> aggregated_output[<span class="st">"a"</span>].replace(<span class="st">"-"</span>, <span class="dv">0</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    aggregated_output[<span class="st">"a"</span>] <span class="op">=</span> aggregated_output[<span class="st">"a"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    aggregated_output[<span class="st">"tp"</span>] <span class="op">=</span> aggregated_output[<span class="st">"tp"</span>].replace(<span class="st">"-"</span>, <span class="dv">0</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    aggregated_output[<span class="st">"tp"</span>] <span class="op">=</span> aggregated_output[<span class="st">"tp"</span>].astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Get corresponding draft year for each row in the dataset (oe. season 2024-2025 would have a draft year of 2025).</p>
<p>Note this isn’t necessarily the players’ draft year - it’s just the draft year for the corresponding row’s season. We will use this to only keep rows where the draft year is the same as the player’s actual draft year.</p>
<div id="8f678995" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> scrape <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    aggregated_output[<span class="st">"draft_year"</span>] <span class="op">=</span> aggregated_output[<span class="st">"year"</span>].<span class="bu">str</span>[<span class="dv">5</span>:]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    aggregated_output[<span class="st">"draft_year"</span>] <span class="op">=</span> aggregated_output[<span class="st">"draft_year"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    aggregated_output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Join games played and draft year onto each row of the OHL player data dataset.</p>
<div id="9329ed8d" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Join GP, draft year onto OHL player data</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> scrape <span class="op">==</span> <span class="va">True</span>:</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#MAKE ALL PLAYER NAMES UPPERCASE (TO MAKE JOINING TABLES NON CASE SENSITIVE)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    aggregated_output[<span class="st">'player'</span>] <span class="op">=</span> aggregated_output[<span class="st">'player'</span>].<span class="bu">str</span>.upper()</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    draftyears[<span class="st">'player'</span>] <span class="op">=</span> draftyears[<span class="st">'player'</span>].<span class="bu">str</span>.upper()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    nhl_gp[<span class="st">'player'</span>] <span class="op">=</span> nhl_gp[<span class="st">'player'</span>].<span class="bu">str</span>.upper()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Filter ohl stats for only drafted players' draft year stats - </span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#This will get rid of a) undrafted players, and b) drafted players non-draft year stats</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.merge(aggregated_output, draftyears, left_on<span class="op">=</span>[<span class="st">'player'</span>, <span class="st">'draft_year'</span>], right_on<span class="op">=</span>[<span class="st">'player'</span>, <span class="st">'player_draft_year'</span>], how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Can get rid of one of the draft year columns - don't need both</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[[<span class="st">"year"</span>, <span class="st">"player"</span>, <span class="st">"gp"</span>, <span class="st">"g"</span>, <span class="st">"a"</span>, <span class="st">"tp"</span>, <span class="st">"dob"</span>, <span class="st">"height"</span>, <span class="st">"weight"</span>, <span class="st">"shoots"</span>, <span class="st">'draft_year'</span>]]</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Join players' games played - if player gp not found, assume it to be 0.</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.merge(df, nhl_gp, left_on<span class="op">=</span>[<span class="st">'player'</span>], right_on<span class="op">=</span>[<span class="st">'player'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nhl_gp"</span>] <span class="op">=</span> df[<span class="st">"nhl_gp"</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"nhl_gp"</span>] <span class="op">=</span> df[<span class="st">"nhl_gp"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    df.to_excel(filename, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, some miscallaneous tidying. Refer to comments for more information.</p>
<div id="6cce681e" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(filename)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Changing the weight to a numerical variate in kg</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"weight_kg"</span>] <span class="op">=</span> df[<span class="st">"weight"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[:x.find(<span class="st">" "</span>)])</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"weight_kg"</span>] <span class="op">=</span> df[<span class="st">"weight_kg"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>df.dtypes</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Can get rid of intermediate columns</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop([<span class="st">"weight"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Renaming height column to height_cm for clarity</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.rename(columns <span class="op">=</span> {<span class="st">"height"</span>: <span class="st">"height_cm"</span>})</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">player</th>
<th data-quarto-table-cell-role="th">gp</th>
<th data-quarto-table-cell-role="th">g</th>
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">tp</th>
<th data-quarto-table-cell-role="th">dob</th>
<th data-quarto-table-cell-role="th">height_cm</th>
<th data-quarto-table-cell-role="th">shoots</th>
<th data-quarto-table-cell-role="th">draft_year</th>
<th data-quarto-table-cell-role="th">nhl_gp</th>
<th data-quarto-table-cell-role="th">weight_kg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2016-2017</td>
<td>PETRUS PALMU</td>
<td>62</td>
<td>40</td>
<td>58</td>
<td>98</td>
<td>1997-07-16</td>
<td>168</td>
<td>L</td>
<td>2017</td>
<td>0</td>
<td>78</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-2017</td>
<td>NICK SUZUKI</td>
<td>65</td>
<td>45</td>
<td>51</td>
<td>96</td>
<td>1999-08-10</td>
<td>180</td>
<td>R</td>
<td>2017</td>
<td>455</td>
<td>94</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2016-2017</td>
<td>JASON ROBERTSON</td>
<td>68</td>
<td>42</td>
<td>39</td>
<td>81</td>
<td>1999-07-22</td>
<td>191</td>
<td>L</td>
<td>2017</td>
<td>374</td>
<td>91</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2016-2017</td>
<td>OWEN TIPPETT</td>
<td>60</td>
<td>44</td>
<td>31</td>
<td>75</td>
<td>1999-02-16</td>
<td>185</td>
<td>R</td>
<td>2017</td>
<td>347</td>
<td>95</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2016-2017</td>
<td>JONAH GADJOVICH</td>
<td>60</td>
<td>46</td>
<td>28</td>
<td>74</td>
<td>1998-10-12</td>
<td>191</td>
<td>L</td>
<td>2017</td>
<td>160</td>
<td>96</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2016-2017</td>
<td>ROBERT THOMAS</td>
<td>66</td>
<td>16</td>
<td>50</td>
<td>66</td>
<td>1999-07-02</td>
<td>183</td>
<td>R</td>
<td>2017</td>
<td>466</td>
<td>85</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2016-2017</td>
<td>DRAKE RYMSHA</td>
<td>65</td>
<td>35</td>
<td>27</td>
<td>62</td>
<td>1998-08-06</td>
<td>183</td>
<td>R</td>
<td>2017</td>
<td>1</td>
<td>91</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2016-2017</td>
<td>MATTHEW STROME</td>
<td>66</td>
<td>34</td>
<td>28</td>
<td>62</td>
<td>1999-01-06</td>
<td>193</td>
<td>L</td>
<td>2017</td>
<td>0</td>
<td>93</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>2016-2017</td>
<td>MORGAN FROST</td>
<td>67</td>
<td>20</td>
<td>42</td>
<td>62</td>
<td>1999-05-14</td>
<td>182</td>
<td>L</td>
<td>2017</td>
<td>310</td>
<td>87</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>2016-2017</td>
<td>GABRIEL VILARDI</td>
<td>49</td>
<td>29</td>
<td>32</td>
<td>61</td>
<td>1999-08-16</td>
<td>191</td>
<td>R</td>
<td>2017</td>
<td>270</td>
<td>98</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>2016-2017</td>
<td>CONOR TIMMINS</td>
<td>67</td>
<td>7</td>
<td>54</td>
<td>61</td>
<td>1998-09-18</td>
<td>188</td>
<td>R</td>
<td>2017</td>
<td>159</td>
<td>97</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>2013-2014</td>
<td>MICHAEL DAL COLLE</td>
<td>67</td>
<td>39</td>
<td>56</td>
<td>95</td>
<td>1996-06-20</td>
<td>191</td>
<td>L</td>
<td>2014</td>
<td>112</td>
<td>88</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>2013-2014</td>
<td>BRENDAN PERLINI</td>
<td>58</td>
<td>34</td>
<td>37</td>
<td>71</td>
<td>1996-04-27</td>
<td>192</td>
<td>L</td>
<td>2014</td>
<td>262</td>
<td>96</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>2013-2014</td>
<td>SPENCER WATSON</td>
<td>65</td>
<td>33</td>
<td>35</td>
<td>68</td>
<td>1996-04-25</td>
<td>178</td>
<td>R</td>
<td>2014</td>
<td>0</td>
<td>77</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>2013-2014</td>
<td>JARED MCCANN</td>
<td>64</td>
<td>27</td>
<td>35</td>
<td>62</td>
<td>1996-05-31</td>
<td>185</td>
<td>L</td>
<td>2014</td>
<td>668</td>
<td>84</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>2013-2014</td>
<td>ERIC CORNEL</td>
<td>68</td>
<td>25</td>
<td>37</td>
<td>62</td>
<td>1996-04-11</td>
<td>188</td>
<td>R</td>
<td>2014</td>
<td>0</td>
<td>90</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>STEP 3: TRANSFORM</strong></p>
<p>Creating some new stats (age at draft, goals per game, points per game, and an indicator variable for whether the player has played at least 200 NHL games). These will all be used in the regression later on.</p>
<div id="6c199442" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Getting the age of the player at the time of draft (for simplicity, we will assume draft to be on June 30 for all years)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"draft_date"</span>] <span class="op">=</span> df[<span class="st">"draft_year"</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">'-06-30'</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"draft_date"</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">"draft_date"</span>])</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"dob"</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">"dob"</span>])</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"age_days"</span>] <span class="op">=</span> (df[<span class="st">"draft_date"</span>] <span class="op">-</span> df[<span class="st">"dob"</span>])</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"age_days"</span>] <span class="op">=</span> df[<span class="st">"age_days"</span>].dt.days</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Can get rid of intermediate columns</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop([<span class="st">"draft_date"</span>, <span class="st">"draft_year"</span>, <span class="st">"dob"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding columns for goals/g and points/g</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"gpg"</span>] <span class="op">=</span> df[<span class="st">"g"</span>] <span class="op">/</span> df[<span class="st">"gp"</span>]</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"ppg"</span>] <span class="op">=</span> df[<span class="st">"tp"</span>] <span class="op">/</span> df[<span class="st">"gp"</span>]</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Create indicator variable to measure if the player has played at least 200 nhl games</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Pr[GP &gt; 200]"</span>] <span class="op">=</span> df[<span class="st">"nhl_gp"</span>] <span class="op">&gt;=</span> <span class="dv">200</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"Pr[GP &gt; 200]"</span>] <span class="op">=</span> df[<span class="st">"Pr[GP &gt; 200]"</span>].astype(<span class="bu">int</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">player</th>
<th data-quarto-table-cell-role="th">gp</th>
<th data-quarto-table-cell-role="th">g</th>
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">tp</th>
<th data-quarto-table-cell-role="th">height_cm</th>
<th data-quarto-table-cell-role="th">shoots</th>
<th data-quarto-table-cell-role="th">nhl_gp</th>
<th data-quarto-table-cell-role="th">weight_kg</th>
<th data-quarto-table-cell-role="th">age_days</th>
<th data-quarto-table-cell-role="th">gpg</th>
<th data-quarto-table-cell-role="th">ppg</th>
<th data-quarto-table-cell-role="th">Pr[GP &gt; 200]</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2016-2017</td>
<td>PETRUS PALMU</td>
<td>62</td>
<td>40</td>
<td>58</td>
<td>98</td>
<td>168</td>
<td>L</td>
<td>0</td>
<td>78</td>
<td>7289</td>
<td>0.645161</td>
<td>1.580645</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-2017</td>
<td>NICK SUZUKI</td>
<td>65</td>
<td>45</td>
<td>51</td>
<td>96</td>
<td>180</td>
<td>R</td>
<td>455</td>
<td>94</td>
<td>6534</td>
<td>0.692308</td>
<td>1.476923</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2016-2017</td>
<td>JASON ROBERTSON</td>
<td>68</td>
<td>42</td>
<td>39</td>
<td>81</td>
<td>191</td>
<td>L</td>
<td>374</td>
<td>91</td>
<td>6553</td>
<td>0.617647</td>
<td>1.191176</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2016-2017</td>
<td>OWEN TIPPETT</td>
<td>60</td>
<td>44</td>
<td>31</td>
<td>75</td>
<td>185</td>
<td>R</td>
<td>347</td>
<td>95</td>
<td>6709</td>
<td>0.733333</td>
<td>1.250000</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2016-2017</td>
<td>JONAH GADJOVICH</td>
<td>60</td>
<td>46</td>
<td>28</td>
<td>74</td>
<td>191</td>
<td>L</td>
<td>160</td>
<td>96</td>
<td>6836</td>
<td>0.766667</td>
<td>1.233333</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2016-2017</td>
<td>ROBERT THOMAS</td>
<td>66</td>
<td>16</td>
<td>50</td>
<td>66</td>
<td>183</td>
<td>R</td>
<td>466</td>
<td>85</td>
<td>6573</td>
<td>0.242424</td>
<td>1.000000</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2016-2017</td>
<td>DRAKE RYMSHA</td>
<td>65</td>
<td>35</td>
<td>27</td>
<td>62</td>
<td>183</td>
<td>R</td>
<td>1</td>
<td>91</td>
<td>6903</td>
<td>0.538462</td>
<td>0.953846</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2016-2017</td>
<td>MATTHEW STROME</td>
<td>66</td>
<td>34</td>
<td>28</td>
<td>62</td>
<td>193</td>
<td>L</td>
<td>0</td>
<td>93</td>
<td>6750</td>
<td>0.515152</td>
<td>0.939394</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>2016-2017</td>
<td>MORGAN FROST</td>
<td>67</td>
<td>20</td>
<td>42</td>
<td>62</td>
<td>182</td>
<td>L</td>
<td>310</td>
<td>87</td>
<td>6622</td>
<td>0.298507</td>
<td>0.925373</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>2016-2017</td>
<td>GABRIEL VILARDI</td>
<td>49</td>
<td>29</td>
<td>32</td>
<td>61</td>
<td>191</td>
<td>R</td>
<td>270</td>
<td>98</td>
<td>6528</td>
<td>0.591837</td>
<td>1.244898</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>2016-2017</td>
<td>CONOR TIMMINS</td>
<td>67</td>
<td>7</td>
<td>54</td>
<td>61</td>
<td>188</td>
<td>R</td>
<td>159</td>
<td>97</td>
<td>6860</td>
<td>0.104478</td>
<td>0.910448</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>2013-2014</td>
<td>MICHAEL DAL COLLE</td>
<td>67</td>
<td>39</td>
<td>56</td>
<td>95</td>
<td>191</td>
<td>L</td>
<td>112</td>
<td>88</td>
<td>6584</td>
<td>0.582090</td>
<td>1.417910</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>2013-2014</td>
<td>BRENDAN PERLINI</td>
<td>58</td>
<td>34</td>
<td>37</td>
<td>71</td>
<td>192</td>
<td>L</td>
<td>262</td>
<td>96</td>
<td>6638</td>
<td>0.586207</td>
<td>1.224138</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>2013-2014</td>
<td>SPENCER WATSON</td>
<td>65</td>
<td>33</td>
<td>35</td>
<td>68</td>
<td>178</td>
<td>R</td>
<td>0</td>
<td>77</td>
<td>6640</td>
<td>0.507692</td>
<td>1.046154</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>2013-2014</td>
<td>JARED MCCANN</td>
<td>64</td>
<td>27</td>
<td>35</td>
<td>62</td>
<td>185</td>
<td>L</td>
<td>668</td>
<td>84</td>
<td>6604</td>
<td>0.421875</td>
<td>0.968750</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>2013-2014</td>
<td>ERIC CORNEL</td>
<td>68</td>
<td>25</td>
<td>37</td>
<td>62</td>
<td>188</td>
<td>R</td>
<td>0</td>
<td>90</td>
<td>6654</td>
<td>0.367647</td>
<td>0.911765</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>STEP 4: VISUALIZE</strong></p>
<p>We will create 2 visualizations, to investiage whether certain variates are correlated with the probability of a player playing more than 200 games in the NHL.</p>
<ul>
<li><p>The first visualization will be a scatterplot of goals per game in the OHL vs.&nbsp;NHL games played, colored by points per game.</p></li>
<li><p>The second visualization will be a scatterplot of height of players in the OHL vs.&nbsp;NHL games played, colored by weight in kg.</p></li>
</ul>
<div id="e9520aea" class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    ggplot(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>      data <span class="op">=</span> df,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>      mapping <span class="op">=</span> aes(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="st">"gpg"</span>, y <span class="op">=</span> <span class="st">"nhl_gp"</span>, color <span class="op">=</span> <span class="st">"ppg"</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>      geom_point() <span class="op">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>      labs(color <span class="op">=</span> <span class="st">"ppg"</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
   <div id="fLcI5S"></div>
   <script type="text/javascript" data-lets-plot-script="plot">
   
   (function() {
   // ----------
   
   const forceImmediateRender = false;
   const responsive = false;
   
   let sizing = {
       width_mode: "MIN",
       height_mode: "SCALED",
       width: null, 
       height: null 
   };
   
   const preferredWidth = document.body.dataset.letsPlotPreferredWidth;
   if (preferredWidth !== undefined) {
       sizing = {
           width_mode: 'FIXED',
           height_mode: 'SCALED',
           width: parseFloat(preferredWidth)
       };
   }
   
   const containerDiv = document.getElementById("fLcI5S");
   let fig = null;
   
   function renderPlot() {
       if (fig === null) {
           const plotSpec = {
"data":{
"nhl_gp":[0.0,455.0,374.0,347.0,160.0,466.0,1.0,0.0,310.0,270.0,159.0,112.0,262.0,0.0,668.0,0.0],
"gpg":[0.6451612903225806,0.6923076923076923,0.6176470588235294,0.7333333333333333,0.7666666666666667,0.24242424242424243,0.5384615384615384,0.5151515151515151,0.29850746268656714,0.5918367346938775,0.1044776119402985,0.582089552238806,0.5862068965517241,0.5076923076923077,0.421875,0.36764705882352944],
"ppg":[1.5806451612903225,1.476923076923077,1.1911764705882353,1.25,1.2333333333333334,1.0,0.9538461538461539,0.9393939393939394,0.9253731343283582,1.2448979591836735,0.9104477611940298,1.4179104477611941,1.2241379310344827,1.0461538461538462,0.96875,0.9117647058823529]
},
"mapping":{
"x":"gpg",
"y":"nhl_gp",
"color":"ppg"
},
"data_meta":{
"series_annotations":[{
"type":"str",
"column":"year"
},{
"type":"str",
"column":"player"
},{
"type":"int",
"column":"gp"
},{
"type":"int",
"column":"g"
},{
"type":"int",
"column":"a"
},{
"type":"int",
"column":"tp"
},{
"type":"int",
"column":"height_cm"
},{
"type":"str",
"column":"shoots"
},{
"type":"int",
"column":"nhl_gp"
},{
"type":"int",
"column":"weight_kg"
},{
"type":"int",
"column":"age_days"
},{
"type":"float",
"column":"gpg"
},{
"type":"float",
"column":"ppg"
},{
"type":"int",
"column":"Pr[GP > 200]"
}]
},
"guides":{
"color":{
"title":"ppg"
}
},
"kind":"plot",
"scales":[],
"layers":[{
"geom":"point",
"mapping":{
},
"data_meta":{
},
"data":{
}
}],
"metainfo_list":[],
"spec_id":"11"
};
           window.letsPlotCall(function() { fig = LetsPlot.buildPlotFromProcessedSpecs(plotSpec, containerDiv, sizing); });
       } else {
           fig.updateView({});
       }
   }
   
   const renderImmediately = 
       forceImmediateRender || (
           sizing.width_mode === 'FIXED' && 
           (sizing.height_mode === 'FIXED' || sizing.height_mode === 'SCALED')
       );
   
   if (renderImmediately) {
       renderPlot();
   }
   
   if (!renderImmediately || responsive) {
       // Set up observer for initial sizing or continuous monitoring
       var observer = new ResizeObserver(function(entries) {
           for (let entry of entries) {
               if (entry.contentBoxSize && 
                   entry.contentBoxSize[0].inlineSize > 0) {
                   if (!responsive && observer) {
                       observer.disconnect();
                       observer = null;
                   }
                   renderPlot();
                   if (!responsive) {
                       break;
                   }
               }
           }
       });
       
       observer.observe(containerDiv);
   }
   
   // ----------
   })();
   
   </script>
</div>
</div>
<div id="1bce07a1" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    ggplot(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>      data <span class="op">=</span> df,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>      mapping <span class="op">=</span> aes(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="st">"height_cm"</span>, y <span class="op">=</span> <span class="st">"nhl_gp"</span>, color <span class="op">=</span> <span class="st">"weight_kg"</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>      geom_point() <span class="op">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>      labs(color <span class="op">=</span> <span class="st">"weight_kg"</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
   <div id="Urt65x"></div>
   <script type="text/javascript" data-lets-plot-script="plot">
   
   (function() {
   // ----------
   
   const forceImmediateRender = false;
   const responsive = false;
   
   let sizing = {
       width_mode: "MIN",
       height_mode: "SCALED",
       width: null, 
       height: null 
   };
   
   const preferredWidth = document.body.dataset.letsPlotPreferredWidth;
   if (preferredWidth !== undefined) {
       sizing = {
           width_mode: 'FIXED',
           height_mode: 'SCALED',
           width: parseFloat(preferredWidth)
       };
   }
   
   const containerDiv = document.getElementById("Urt65x");
   let fig = null;
   
   function renderPlot() {
       if (fig === null) {
           const plotSpec = {
"data":{
"height_cm":[168.0,180.0,191.0,185.0,191.0,183.0,183.0,193.0,182.0,191.0,188.0,191.0,192.0,178.0,185.0,188.0],
"nhl_gp":[0.0,455.0,374.0,347.0,160.0,466.0,1.0,0.0,310.0,270.0,159.0,112.0,262.0,0.0,668.0,0.0],
"weight_kg":[78.0,94.0,91.0,95.0,96.0,85.0,91.0,93.0,87.0,98.0,97.0,88.0,96.0,77.0,84.0,90.0]
},
"mapping":{
"x":"height_cm",
"y":"nhl_gp",
"color":"weight_kg"
},
"data_meta":{
"series_annotations":[{
"type":"str",
"column":"year"
},{
"type":"str",
"column":"player"
},{
"type":"int",
"column":"gp"
},{
"type":"int",
"column":"g"
},{
"type":"int",
"column":"a"
},{
"type":"int",
"column":"tp"
},{
"type":"int",
"column":"height_cm"
},{
"type":"str",
"column":"shoots"
},{
"type":"int",
"column":"nhl_gp"
},{
"type":"int",
"column":"weight_kg"
},{
"type":"int",
"column":"age_days"
},{
"type":"float",
"column":"gpg"
},{
"type":"float",
"column":"ppg"
},{
"type":"int",
"column":"Pr[GP > 200]"
}]
},
"guides":{
"color":{
"title":"weight_kg"
}
},
"kind":"plot",
"scales":[],
"layers":[{
"geom":"point",
"mapping":{
},
"data_meta":{
},
"data":{
}
}],
"metainfo_list":[],
"spec_id":"12"
};
           window.letsPlotCall(function() { fig = LetsPlot.buildPlotFromProcessedSpecs(plotSpec, containerDiv, sizing); });
       } else {
           fig.updateView({});
       }
   }
   
   const renderImmediately = 
       forceImmediateRender || (
           sizing.width_mode === 'FIXED' && 
           (sizing.height_mode === 'FIXED' || sizing.height_mode === 'SCALED')
       );
   
   if (renderImmediately) {
       renderPlot();
   }
   
   if (!renderImmediately || responsive) {
       // Set up observer for initial sizing or continuous monitoring
       var observer = new ResizeObserver(function(entries) {
           for (let entry of entries) {
               if (entry.contentBoxSize && 
                   entry.contentBoxSize[0].inlineSize > 0) {
                   if (!responsive && observer) {
                       observer.disconnect();
                       observer = null;
                   }
                   renderPlot();
                   if (!responsive) {
                       break;
                   }
               }
           }
       });
       
       observer.observe(containerDiv);
   }
   
   // ----------
   })();
   
   </script>
</div>
</div>
<p>We can see a little bit or correlation in both graphs. In the nwxt step, we will use regression to try and come with a better model that better quanitifies the impact of multiple variables on the probability of a player playing more than 200 games in the NHL.</p>
<p><strong>STEP 5: MODEL</strong></p>
<p>We are going to create a logistic regression model. Logsitic regression is used since we are regressing for a probability, which needs to be bounded between 0 and 1. The model will aim to predict the probability a player becoming an everyday NHL player (play 200 NHL games or more):</p>
<div id="4c32458d" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># X: predictors, y: binary response</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df_regress <span class="op">=</span> df[df[<span class="st">"year"</span>].isin([<span class="st">"2004-2005"</span>, <span class="st">"2006-2007"</span>, <span class="st">"2007-2008"</span>, <span class="st">"2008-2009"</span>, <span class="st">"2009-2010"</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"2014-2015"</span>, <span class="st">"2015-2016"</span>, <span class="st">"2016-2017"</span>, <span class="st">"2017-2018"</span>, <span class="st">"2018-2019"</span>])]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_regress[[<span class="st">'tp'</span>, <span class="st">'height_cm'</span>, <span class="st">'weight_kg'</span>, <span class="st">'age_days'</span>, <span class="st">'gpg'</span>, <span class="st">'ppg'</span>]]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)  <span class="co"># adds intercept</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_regress[<span class="st">'Pr[GP &gt; 200]'</span>]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.Logit(y, X)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> model.fit()</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: Maximum number of iterations has been exceeded.
         Current function value: 0.000000
         Iterations: 35
                           Logit Regression Results                           
==============================================================================
Dep. Variable:           Pr[GP &gt; 200]   No. Observations:                   11
Model:                          Logit   Df Residuals:                        4
Method:                           MLE   Df Model:                            6
Date:                Tue, 05 Aug 2025   Pseudo R-squ.:                   1.000
Time:                        01:27:31   Log-Likelihood:            -3.9237e-09
converged:                      False   LL-Null:                       -7.5791
Covariance Type:            nonrobust   LLR p-value:                   0.01906
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const       3675.8803        nan        nan        nan         nan         nan
tp             2.2330        nan        nan        nan         nan         nan
height_cm    -12.0059   6.89e+09  -1.74e-09      1.000   -1.35e+10    1.35e+10
weight_kg     11.1335   3.02e+09   3.68e-09      1.000   -5.92e+09    5.92e+09
age_days      -0.3737        nan        nan        nan         nan         nan
gpg           33.7468        nan        nan        nan         nan         nan
ppg         -104.6696    3.4e+10  -3.07e-09      1.000   -6.67e+10    6.67e+10
==============================================================================

Complete Separation: The results show that there iscomplete separation or perfect prediction.
In this case the Maximum Likelihood Estimator does not exist and the parameters
are not identified.</code></pre>
</div>
</div>
<p>The p-values tell us that …</p>
<p><strong>STEP 6: COMMUNICATE</strong></p>
<p>Let’s first look at if there is multicollinearity in our data:</p>
<div id="f2273bf4" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X.corr())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           const        tp  height_cm  weight_kg  age_days       gpg       ppg
const        NaN       NaN        NaN        NaN       NaN       NaN       NaN
tp           NaN  1.000000  -0.618148  -0.401491  0.292035  0.565618  0.895680
height_cm    NaN -0.618148   1.000000   0.784210 -0.572902 -0.038544 -0.525288
weight_kg    NaN -0.401491   0.784210   1.000000 -0.490385  0.117542 -0.232743
age_days     NaN  0.292035  -0.572902  -0.490385  1.000000  0.086337  0.256884
gpg          NaN  0.565618  -0.038544   0.117542  0.086337  1.000000  0.705083
ppg          NaN  0.895680  -0.525288  -0.232743  0.256884  0.705083  1.000000</code></pre>
</div>
</div>
<p>Now, we will test out our model on a test set. We will use the model to predict the probability of a player becoming an everyday NHL player (playing 200 or more NHL games). We will do so on seasons we did not train our model on.</p>
<div id="9d59b91c" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Testing model out</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df_test <span class="op">=</span> df[df[<span class="st">"year"</span>].isin([<span class="st">"2010-2011"</span>, <span class="st">"2011-2012"</span>, <span class="st">"2012-2013"</span>, <span class="st">"2013-2014"</span>])]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_test[[<span class="st">'tp'</span>, <span class="st">'height_cm'</span>, <span class="st">'weight_kg'</span>, <span class="st">'age_days'</span>, <span class="st">'gpg'</span>, <span class="st">'ppg'</span>]]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X, has_constant<span class="op">=</span><span class="st">'add'</span>)  <span class="co"># adds intercept</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#If regression yields a probability greater than or equal to 0.5, we will say it predicts the player will become a full-time NHL player</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>df_test[<span class="st">"pred_prob"</span>] <span class="op">=</span> result.predict(X) <span class="op">&gt;=</span> <span class="fl">0.5</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>df_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">player</th>
<th data-quarto-table-cell-role="th">gp</th>
<th data-quarto-table-cell-role="th">g</th>
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">tp</th>
<th data-quarto-table-cell-role="th">height_cm</th>
<th data-quarto-table-cell-role="th">shoots</th>
<th data-quarto-table-cell-role="th">nhl_gp</th>
<th data-quarto-table-cell-role="th">weight_kg</th>
<th data-quarto-table-cell-role="th">age_days</th>
<th data-quarto-table-cell-role="th">gpg</th>
<th data-quarto-table-cell-role="th">ppg</th>
<th data-quarto-table-cell-role="th">Pr[GP &gt; 200]</th>
<th data-quarto-table-cell-role="th">pred_prob</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>2013-2014</td>
<td>MICHAEL DAL COLLE</td>
<td>67</td>
<td>39</td>
<td>56</td>
<td>95</td>
<td>191</td>
<td>L</td>
<td>112</td>
<td>88</td>
<td>6584</td>
<td>0.582090</td>
<td>1.417910</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>2013-2014</td>
<td>BRENDAN PERLINI</td>
<td>58</td>
<td>34</td>
<td>37</td>
<td>71</td>
<td>192</td>
<td>L</td>
<td>262</td>
<td>96</td>
<td>6638</td>
<td>0.586207</td>
<td>1.224138</td>
<td>1</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>2013-2014</td>
<td>SPENCER WATSON</td>
<td>65</td>
<td>33</td>
<td>35</td>
<td>68</td>
<td>178</td>
<td>R</td>
<td>0</td>
<td>77</td>
<td>6640</td>
<td>0.507692</td>
<td>1.046154</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>2013-2014</td>
<td>JARED MCCANN</td>
<td>64</td>
<td>27</td>
<td>35</td>
<td>62</td>
<td>185</td>
<td>L</td>
<td>668</td>
<td>84</td>
<td>6604</td>
<td>0.421875</td>
<td>0.968750</td>
<td>1</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>2013-2014</td>
<td>ERIC CORNEL</td>
<td>68</td>
<td>25</td>
<td>37</td>
<td>62</td>
<td>188</td>
<td>R</td>
<td>0</td>
<td>90</td>
<td>6654</td>
<td>0.367647</td>
<td>0.911765</td>
<td>0</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Next, we will look at model accuracy. We will use TP, TN, FP, FN to calculate accuracy.</p>
<p>Finally, we will look at the ROC curve and AUC to evaluate the model’s performance.</p>
<div id="bac83b07" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>TP <span class="op">=</span> df_test[(df_test[<span class="st">"Pr[GP &gt; 200]"</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (df_test[<span class="st">"pred_prob"</span>] <span class="op">==</span> <span class="va">True</span>)].shape[<span class="dv">0</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Positive: </span><span class="sc">{</span>TP<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>TN <span class="op">=</span> df_test[(df_test[<span class="st">"Pr[GP &gt; 200]"</span>] <span class="op">==</span> <span class="va">False</span>) <span class="op">&amp;</span> (df_test[<span class="st">"pred_prob"</span>] <span class="op">==</span> <span class="va">False</span>)].shape[<span class="dv">0</span>]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Negative: </span><span class="sc">{</span>TN<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>FP <span class="op">=</span> df_test[(df_test[<span class="st">"Pr[GP &gt; 200]"</span>] <span class="op">==</span> <span class="va">False</span>) <span class="op">&amp;</span> (df_test[<span class="st">"pred_prob"</span>] <span class="op">==</span> <span class="va">True</span>)].shape[<span class="dv">0</span>]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Positive: </span><span class="sc">{</span>FP<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>FN <span class="op">=</span> df_test[(df_test[<span class="st">"Pr[GP &gt; 200]"</span>] <span class="op">==</span> <span class="va">True</span>) <span class="op">&amp;</span> (df_test[<span class="st">"pred_prob"</span>] <span class="op">==</span> <span class="va">False</span>)].shape[<span class="dv">0</span>]</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"False Negative: </span><span class="sc">{</span>FN<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> (TP <span class="op">+</span> TN) <span class="op">/</span> (TP <span class="op">+</span> TN <span class="op">+</span> FP <span class="op">+</span> FN) <span class="cf">if</span> (TP <span class="op">+</span> TN <span class="op">+</span> FP <span class="op">+</span> FN) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>true_positive_rate <span class="op">=</span> TP <span class="op">/</span> (TP <span class="op">+</span> FN) <span class="cf">if</span> (TP <span class="op">+</span> FN) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Positive Rate: </span><span class="sc">{</span>true_positive_rate<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>true_negative_rate <span class="op">=</span> FP <span class="op">/</span> (FP <span class="op">+</span> TN) <span class="cf">if</span> (FP <span class="op">+</span> TN) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"True Negative Rate: </span><span class="sc">{</span>true_negative_rate<span class="sc">:.2%}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>True Positive: 1
True Negative: 3
False Positive: 0
False Negative: 1
Accuracy: 80.00%
True Positive Rate: 50.00%
True Negative Rate: 0.00%</code></pre>
</div>
</div>
<p>We will also use ROC curve to look at the TPR, FPR of different thresholds. We can calculate AUR from this to measure accuracy of model considering all thresholds (AUS = 1 means perfect model, AUS = 0.5 means random guessing).:</p>
<div id="7f66e3df" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, auc</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># True labels and predicted probabilities</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> df_test[<span class="st">"Pr[GP &gt; 200]"</span>]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>y_score <span class="op">=</span> result.predict(X)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute ROC curve and AUC</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y_true, y_score)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC curve</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>plt.plot(fpr, tpr, color<span class="op">=</span><span class="st">'darkorange'</span>, lw<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'ROC curve (AUC = </span><span class="sc">{</span>roc_auc<span class="sc">:.2f}</span><span class="ss">)'</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], color<span class="op">=</span><span class="st">'navy'</span>, lw<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>plt.xlim([<span class="fl">0.0</span>, <span class="fl">1.0</span>])</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="fl">0.0</span>, <span class="fl">1.05</span>])</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'False Positive Rate'</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'True Positive Rate'</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Receiver Operating Characteristic'</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_report_files/figure-html/cell-20-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>STORE MODEL IN AWS S3 BUCKET</strong></p>
<p>The code below will store the model in an AWS S3 bucket. I had to make a custom handler, since vetiver cannot handle sm.Logit models by default.</p>
<div id="e6b2d9ef" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> vetiver.handlers.base <span class="im">import</span> BaseHandler</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Need to create a custom handler for statsmodels Logit models, as the default handler cannot handle this type of model</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> StatsmodelsLogitHandler(BaseHandler):</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, model, prototype_data):</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(model, prototype_data)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">@staticmethod</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> model_type():</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"statsmodels_logit"</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    pip_name <span class="op">=</span> <span class="st">"statsmodels"</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> handler_predict(<span class="va">self</span>, input_data, check_prototype: <span class="bu">bool</span>):</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Make predictions using a fitted statsmodels Logit model.</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">        Parameters</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co">        ----------</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co">        input_data:</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co">            New data (e.g., from API)</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co">        check_prototype: bool</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co">            Whether to check data shape</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co">        Returns</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co">        -------</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co">        Prediction array from model.predict</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add constant to match model spec</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>        input_data_const <span class="op">=</span> sm.add_constant(input_data, has_constant<span class="op">=</span><span class="st">'add'</span>)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        prediction <span class="op">=</span> <span class="va">self</span>.model.predict(input_data_const)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> prediction</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="7efe03b7" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pins <span class="im">import</span> board_s3</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> vetiver <span class="im">import</span> vetiver_pin_write</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> vetiver <span class="im">import</span> VetiverModel</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Store the model in an S3 bucket:</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> board_s3(<span class="st">"devakshah-stat468-models"</span>, allow_pickle_read<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>custom_handler <span class="op">=</span> StatsmodelsLogitHandler(result, prototype_data<span class="op">=</span>X)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>vetiver_model <span class="op">=</span> VetiverModel(custom_handler, model_name<span class="op">=</span><span class="st">"my_logit_model"</span>, description<span class="op">=</span><span class="st">"Logistic regression"</span>, handler<span class="op">=</span>custom_handler)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>vetiver_pin_write(board, vetiver_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Model Cards provide a framework for transparent, responsible reporting. 
 Use the vetiver `.qmd` Quarto template as a place to start, 
 with vetiver.model_card()
('The hash of pin "my_logit_model" has not changed. Your pin will not be stored.',)</code></pre>
</div>
</div>
<p>The code below is used to store other data in the AWS S3 bucket. This data will be imported into the Shiny App.</p>
<div id="07a6c974" class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Storing Other Data used by app / report in s3 bucket:</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>board <span class="op">=</span> board_s3(<span class="st">"devakshah-stat468-models"</span>, allow_pickle_read<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>board.pin_write(df, name<span class="op">=</span><span class="st">"regression_input_data"</span>, <span class="bu">type</span><span class="op">=</span><span class="st">"csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>('The hash of pin "regression_input_data" has not changed. Your pin will not be stored.',)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>Meta(title='regression_input_data: a pinned 16 x 14 DataFrame', description=None, created='20250805T011537Z', pin_hash='d624f51088c9863f', file='regression_input_data.csv', file_size=1535, type='csv', api_version=1, version=Version(created=datetime.datetime(2025, 8, 5, 1, 15, 37), hash='d624f'), tags=None, name='regression_input_data', user={}, local={})</code></pre>
</div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/devakshah1\.github\.io\/STAT468-Final\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>